import{I as S,g as E,d as k,c as C,e as P,b as v,j as e,R as b}from"./index-MvMXq-n0.js";import{P as Q}from"./PriceSidebar-aPHY00Eq.js";import{S as V}from"./Stepper-DLGzd-_Q.js";import{c as D,g as U}from"./orderAction-DNHmzoav.js";import{M as J}from"./MetaData-9cgP_bKj.js";import{F as q}from"./FormControl-qVIzL6n1.js";import{R as I,F,a as G}from"./RadioGroup-DEuAC6K4.js";import{u as R}from"./useSelector-SRzZOS-t.js";import"./createSvgIcon-SQw11Wbz.js";import"./createSvgIcon-C4GUxbwI.js";import"./useIsFocusVisible-GM2u4gWw.js";import"./Typography-BQ15CUTf.js";import"./ButtonBase-C1Kn2UJM.js";var y={},j;function L(){if(j)return y;j=1;var h=y&&y.__awaiter||function(c,o,r,n){function l(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function i(t){try{a(n.next(t))}catch(u){p(u)}}function m(t){try{a(n.throw(t))}catch(u){p(u)}}function a(t){t.done?s(t.value):l(t.value).then(i,m)}a((n=n.apply(c,o||[])).next())})};Object.defineProperty(y,"__esModule",{value:!0});const f=S();class x{constructor(o){this.options=o,typeof window<"u"&&(this.rzrpayInstannce=new window.Razorpay(this.options))}on(o,r){this.rzrpayInstannce.on(o,r)}open(){this.rzrpayInstannce.open()}}const d=()=>{const c="https://checkout.razorpay.com/v1/checkout.js",o=(0,f.useMemo)(()=>typeof window<"u",[]),r=(0,f.useCallback)(()=>!(!o||!("Razorpay"in window)),[]),n=(0,f.useCallback)(l=>{if(o)return new Promise((s,p)=>{const i=document.createElement("script");i.src=l,i.onload=m=>s(m),i.onerror=m=>p(m),document.body.appendChild(i)})},[]);return(0,f.useEffect)(()=>{r()||h(void 0,void 0,void 0,function*(){try{yield n(c)}catch(l){throw new Error(l)}})},[]),x};return y.default=d,y}var N=L();const K=E(N),B={headers:{"Content-Type":"application/json"},withCredentials:!0},ne=()=>{const h=k(),f=C(),x=K(),{enqueueSnackbar:d}=P(),{shippingInfo:c,cartItems:o}=R(a=>a.cart),{user:r}=R(a=>a.user),{error:n}=R(a=>a.newOrder),l=o.reduce((a,t)=>a+t.price*t.quantity,0),[s,p]=v.useState(!1),i={amount:Math.round(l*100),phoneNo:c.phoneNo,email:r.email},m=async a=>{a.preventDefault(),p(!0);try{let t=function(A){return new Promise((w,g)=>{const z=document.createElement("script");z.src=A,z.onload=w,z.onerror=g,document.head.appendChild(z)})};const{data:u}=await b.post("http://localhost:3000/api/v1/payment/process",i,B),H={key:"rzp_test_3rq9LxL4Bj1W9V",amount:u.amount,currency:u.currency,name:"Flipkart",description:"Order Payment",email:i.email,contact:c.phoneNo,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAnFBMVEVHcEzy0UDInSPYqizbripqYVHWzHzy20Tq2F3u2VXzwTB3XBrz2D7ery315UnhsS0wcKL15k7y20oAbr4Hb7sHa7b64DH55DD82TEGheP45y8Kg9n63THxxi/4xzHuvC/+yjHlsyz80zLowysEetP/3h7vxBUHecyMp6L450G0qWhxlaQgi9hMkMB3pLTksBbWu1G0uomVnYXXyWSrIjT1AAAAFnRSTlMAcUl4/Q0a9T9Q7B20jsuoXL2GgoFsvBma+wAAAadJREFUOI11kw1zojAQhiN+BGxte+2dBoEQQggB+dL+//92uwmeIL1nnGHG53V32URCpmz9IPB35D/4r9XZUv0KftABPU+oVs/+bWJPwJnOOu2qiRup/Cd/euJ4eiSqhXTcu7wtlYOO8y9lAcAj/rQB+vS7U0GvpjM0Bux+ZvYYH+MuRLqCMYbreHVfW4XQxvqw0RDAKeJ/CmEFeBtpdQIJOJ+JBAqDuqm11nkuGfOJf1eOAouHQ44kiZQrErAZ32ETQfUxwBeB4hpGUWi08wkXK+LflaPDQI0DJBjgK7Kzml4793YRgM8BvUyER4hk0kK7yNLYTO0KiC0symomv030INxkdoQ9nhXoob4ZcwFatO3lUmdZyqHAAQ+DS5nkuc5hN9ooCNz6Pttk2diBkLXERJrCR7eqVKregE7TlIt3dyH2Ugjrcx0pFSn0NsDHG/XChRQ4dTJAgbLpXYBz734nPQHATLxWZVle+rHA+nGtPW4DwkBA3fqFhy57LCJaKKBqV8Ajcw5QRGAHha+QvW8Xf87tej9goIQlHF4W2mU+/vz++vBm9i+r/FSYRl4w2gAAAABJRU5ErkJggg==",order_id:u.id,handler:async function(A){try{const w={id:A.razorpay_payment_id,order_id:A.razorpay_order_id,signature:A.razorpay_signature};let g=await b.post("http://localhost:3000/api/v1/callback",w,B);h(U(g.data.order_id)),f(`/order/${g.data.order_id}`)}catch{d("Payment failed",{variant:"error"})}},prefill:{name:r.name,email:r.email,phone:c.phoneNo}};await t("https://checkout.razorpay.com/v1/checkout.js")?new x(H).open():d("Failed to load Razorpay. Please try again later.",{variant:"error"})}catch{d("Payment failed",{variant:"error"})}};return v.useEffect(()=>{n&&(h(D()),d(n,{variant:"error"}))},[h,n,d]),e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Flipkart: Secure Payment | Razorpay"}),e.jsx("main",{className:"w-full mt-20",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3.5 w-full sm:w-11/12 mt-0 sm:mt-4 m-auto sm:mb-7",children:[e.jsx("div",{className:"flex-1",children:e.jsx(V,{activeStep:3,children:e.jsx("div",{className:"w-full bg-white",children:e.jsxs("form",{onSubmit:a=>m(a),autoComplete:"off",className:"flex flex-col justify-start gap-2 w-full mx-8 my-4 overflow-hidden",children:[e.jsx(q,{children:e.jsx(I,{"aria-labelledby":"payment-radio-group",defaultValue:"paytm",name:"payment-radio-button",children:e.jsx(F,{value:"paytm",control:e.jsx(G,{}),label:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{draggable:"false",className:"h-6 w-6 object-contain",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAWlBMVEVHcEwzlf8zlf8zlf8zlf8vhcozlf8zlv8zlf8zlf8zlf80mP80mP8zlf80l/8zlf8zlf8zlf8CDzUmdc07q/8GJVMHJlQHJlQFIE0GJVQHJlQHJlQEIk8HJlRFd1ufAAAAHnRSTlMAkjv/qwS+VxDTaCBHhC7kdfkmDBeI6P9Cpr1RZ9dOi+BjAAAA1ElEQVR4AX3RhQHDQAwDQKUKMzu4/5qtS6H/3AAGCbcc3HrQxQ3PJwPYBXwJYRNGfIlgE5PKgVkS8SOFUUalYJIXVNYTHG5KXFVURUSVm7JTGahoWVAkyKlMOUe6uEZJFeOiYdSi6xHRknMQo+6lA1UBk05E6tR6wiAKjiVnbxQ1oaDycDLLx+IZc24m+aqDb1oHi/zBpXpgp17lb0R1zXmUzdJS+diTHa+8Vl3LpodPlRzj24ygqrC3ymYwVS07yKiCSwNfKwqq0HbCVrXlhG/VDv6ecxEVjOgZDPAAAAAASUVORK5CYII=",alt:"Razorpay Logo"}),e.jsx("span",{children:"Razorpay"})]})})})}),e.jsx("input",{type:"submit",value:`Pay â‚¹${l.toLocaleString()}`,disabled:!!s,className:`${s?"bg-primary-grey cursor-not-allowed":"bg-primary-orange cursor-pointer"} w-1/2 sm:w-1/4 my-2 py-3 font-medium text-white shadow hover:shadow-lg rounded-sm uppercase outline-none`})]})})})}),e.jsx(Q,{cartItems:o})]})})]})};export{ne as default};
